---
title: "Plots"
author: "Carlotta Sampels"
date: "2025-03-25"
output: html_document
---


```{r Setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	cache = FALSE,
	comment = NA,
	prompt = FALSE)
```

Clear global environment prior to initiation
```{r Clear global environment}
remove(list = ls())
```

Read in file with path to ilovedata channel on Teams
```{r Read in paths file}
source(file = "credentials/paths.R")
```

Load packages
```{r Load packages}
library(ggplot2)
library(dplyr)
library(UpSetR)
library(patchwork)
library(tidyverse)
```

Retrieve the recent date
```{r Recent date}
date = Sys.Date()
date
```

Read in data
```{r Read in data}
dat <- read_rds(
  #file = paste0(filepath_cleaned_data,"dat_variable_creation", date, ".rds"))
  file = paste0(filepath_cleaned_data,"dat_after_exclusion", "2025-03-29", ".rds"))
```

#Plots
```{r density plot}
ggplot(dat, aes(x = age, fill = sexual_orientation)) +
  geom_density(alpha = 0.5) +
  labs(title = "Density Plot",
       x = "Age",
       y = "Density",
       fill = "Sexual orientation") +
  theme_minimal() +
  facet_wrap(vars(sexual_orientation),nrow = 6)

ggplot(dat, aes(x = age, fill = gender)) +
  geom_density(alpha = 0.5) +
  labs(title = "Density Plot",
       x = "Age",
       y = "Density",
       fill = "Gender") +
  theme_minimal() +
  facet_wrap(vars(gender),nrow = 4)
```

```{r UpSetR irgendwas}
# Diagnosen als binäre Spalten (1 = hat Diagnose, 0 = nicht)
psy_vars <- c("mhd.mdd", "mhd.gad", "mhd.an")  # ggf. ergänzen

# Erstellt reinen Dataframe mit binären Werten
dat_binary <- dat %>%
  mutate(across(all_of(psy_vars), ~ as.numeric(as.character(.) == "MDD" | . == "GAD" | . == "AN"))) %>%
  select(all_of(psy_vars)) %>%
  as.data.frame()

# UpSet-Plot
upset(dat_binary,
      sets = psy_vars,
      order.by = "freq",
      sets.bar.color = "#619CFF",
      main.bar.color = "#F8766D",
      text.scale = 1.3)

for (group in levels(dat$sexual_orientation)) {
  cat("Sexuelle Orientierung:", group, "\n")
  
  dat_group <- dat %>%
    filter(sexual_orientation == group) %>%
    mutate(across(all_of(psy_vars), ~ as.numeric(. == levels(.)[2]))) %>%
    select(all_of(psy_vars)) %>%
    as.data.frame()
  
  print(upset(dat_group,
              sets = psy_vars,
              mainbar.y.label = paste("Overlap bei:", group),
              sets.bar.color = "#00BA38",
              main.bar.color = "#619CFF",
              order.by = "freq",
              text.scale = 1.3))
}

# Umwandeln der Daten in binäre (0/1) Form für jede Diagnose
dat$mhd.mdd_bin <- ifelse(dat$mhd.mdd == "MDD", 1, 0)
dat$mhd.gad_bin <- ifelse(dat$mhd.gad == "GAD", 1, 0)
dat$mhd.an_bin <- ifelse(dat$mhd.an == "AN", 1, 0)

# Umwandeln der sexuellen Orientierung in binäre Form (wir verwenden nur "Heterosexual" vs. anderen)
dat$sexual_orientation_bin <- ifelse(dat$sexual_orientation == "Heterosexual", 1, 0)

# Erstellen eines neuen Data Frames mit den relevanten Variablen für UpSetR
upset_data <- data.frame(
  MDD = dat$mhd.mdd_bin,
  GAD = dat$mhd.gad_bin,
  AN = dat$mhd.an_bin,
  SexualOrientation = dat$sexual_orientation_bin
)

# Anzeigen des UpSetR-Diagramms
upset(upset_data, sets = c("MDD", "GAD", "AN", "SexualOrientation"))


```

```{r UpSetR}
psy_vars <- c("mhd.an", "mhd.atypical_an", "mhd.bn", "mhd.bed")

# Loop over all sexual orientation groups to visualize overlaps
for (group in levels(dat$sexual_orientation)) {
  cat("Sexual orientation:", group, "\n")
  
  # Filter data and convert diagnoses to 0/1 (binary)
  dat_group <- dat %>%
    filter(sexual_orientation == group) %>%
    mutate(across(all_of(psy_vars), ~ as.numeric(. == levels(.)[2]))) %>%
    select(all_of(psy_vars)) %>%
    as.data.frame()
  
  # Create UpSet plot
  print(upset(dat_group,
              sets = psy_vars,
              mainbar.y.label = paste("Overlap by:", group),
              sets.bar.color = "#00BA38",
              main.bar.color = "#619CFF",
              order.by = "freq",
              text.scale = 1.3))
}

```

```{r Gad7, PHQ9, Age}
# GAD-7 by Gender
p1 <- ggplot(dat, aes(x = gender, y = gad7.sum_score, fill = gender)) +
  geom_boxplot() +
  labs(title = "GAD-7 by Gender", x = "Gender", y = "GAD-7 Sum Score") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# GAD-7 by Sexual Orientation
p2 <- ggplot(dat, aes(x = sexual_orientation, y = gad7.sum_score, fill = sexual_orientation)) +
  geom_boxplot() +
  labs(title = "GAD-7 by Sexual Orientation", x = "Sexual Orientation", y = "GAD-7 Sum Score") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# PHQ-9 by Gender
p3 <- ggplot(dat, aes(x = gender, y = phq9.sum_score, fill = gender)) +
  geom_boxplot() +
  labs(title = "PHQ-9 by Gender", x = "Gender", y = "PHQ-9 Sum Score") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# PHQ-9 by Sexual Orientation
p4 <- ggplot(dat, aes(x = sexual_orientation, y = phq9.sum_score, fill = sexual_orientation)) +
  geom_boxplot() +
  labs(title = "PHQ-9 by Sexual Orientation", x = "Sexual Orientation", y = "PHQ-9 Sum Score") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Age by Gender
p5 <- ggplot(dat, aes(x = gender, y = age, fill = gender)) +
  geom_boxplot() +
  labs(title = "Age by Gender", x = "Gender", y = "Age") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Age by Sexual Orientation
p6 <- ggplot(dat, aes(x = sexual_orientation, y = age, fill = sexual_orientation)) +
  geom_boxplot() +
  labs(title = "Age by Sexual Orientation", x = "Sexual Orientation", y = "Age") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

(p1 + p3 + p5) /
(p2 + p4 + p6)
```


```{r age}
ggplot(dat, aes(x = age)) +
  geom_density() +
  labs(title = "Density Plot of Age", x = "Age", y = "Density") +
  theme_minimal()

ggplot(dat, aes(x = age)) +
  geom_density(fill = "lightblue", alpha = 0.5) +
  geom_vline(aes(xintercept = mean(dat$age)), color = "red", linetype = "dashed", size = 1) +  
  annotate("text", x = mean(dat$age), y = 0, 
           label = paste0("Mean = ", round(mean(dat$age), 2)), 
           color = "black", angle = 90, vjust = -0.5, hjust = 0) +
  labs(title = "Density Plot of Age with Mean", x = "Age", y = "Density") +
  theme_minimal()

ggplot(dat, aes(x = "", y = age)) +
  geom_boxplot(fill = "blue", color = "black") +
  labs(title = "Boxplot of Age", x = "", y = "Age") +
  theme_minimal()
```

```{r BMI}
# Density Plot ohne Mittelwert
ggplot(dat, aes(x = bmi)) +
  geom_density() +
  labs(title = "Density Plot of BMI", x = "BMI", y = "Density") +
  theme_minimal()

# Density Plot mit Mittelwertlinie
ggplot(dat, aes(x = bmi)) +
  geom_density(fill = "lightblue", alpha = 0.5) +
  geom_vline(aes(xintercept = mean(bmi, na.rm = TRUE)), 
             color = "red", linetype = "dashed", size = 1) +  
  annotate("text", x = mean(dat$bmi), y = 0, 
           label = paste0("Mean = ", round(mean(dat$bmi), 2)), 
           color = "black", angle = 90, vjust = -0.5, hjust = 0) +
  labs(title = "Density Plot of BMI with Mean", x = "BMI", y = "Density") +
  theme_minimal()

# Boxplot
ggplot(dat, aes(x = "", y = bmi)) +
  geom_boxplot(fill = "blue", color = "black") +
  labs(title = "Boxplot of BMI", x = "", y = "BMI") +
  theme_minimal()
```

```{r}
# Density Plot ohne Mittelwert
ggplot(dat, aes(x = phq9.sum_score)) +
  geom_density() +
  labs(title = "Density Plot of PHQ-9 Score", x = "PHQ-9 Score", y = "Density") +
  theme_minimal()

# Density Plot mit Mittelwertlinie
ggplot(dat, aes(x = phq9.sum_score)) +
  geom_density(fill = "lightblue", alpha = 0.5) +
  geom_vline(aes(xintercept = mean(phq9.sum_score, na.rm = TRUE)), 
             color = "red", linetype = "dashed", size = 1) +  
  annotate("text", x = mean(dat$phq9.sum_score, na.rm = TRUE), y = 0, 
           label = paste0("Mean = ", round(mean(dat$phq9.sum_score, na.rm = TRUE), 2)), 
           color = "black", angle = 90, vjust = -0.5, hjust = 0) +
  labs(title = "Density Plot of PHQ-9 Score with Mean", x = "PHQ-9 Score", y = "Density") +
  theme_minimal()

# Boxplot
ggplot(dat, aes(x = "", y = phq9.sum_score)) +
  geom_boxplot(fill = "blue", color = "black") +
  labs(title = "Boxplot of PHQ-9 Score", x = "", y = "PHQ-9 Score") +
  theme_minimal()
```

```{r}
# Density Plot ohne Mittelwert
ggplot(dat, aes(x = gad7.sum_score)) +
  geom_density() +
  labs(title = "Density Plot of GAD-7", x = "GAD-7", y = "Density") +
  theme_minimal()

# Density Plot mit Mittelwertlinie
ggplot(dat, aes(x = gad7.sum_score)) +
  geom_density(fill = "lightblue", alpha = 0.5) +
  geom_vline(aes(xintercept = mean(gad7.sum_score, na.rm = TRUE)), 
             color = "red", linetype = "dashed", size = 1) +
  annotate("text", x = mean(dat$gad7.sum_score, na.rm = TRUE), y = 0, 
           label = paste0("Mean = ", round(mean(dat$gad7.sum_score, na.rm = TRUE), 2)), 
           color = "black", angle = 90, vjust = -0.5, hjust = 0) +
  labs(title = "Density Plot of GAD-7 with Mean", x = "GAD-7", y = "Density") +
  theme_minimal()

# Boxplot
ggplot(dat, aes(x = "", y = gad7.sum_score)) +
  geom_boxplot(fill = "blue", color = "black") +
  labs(title = "Boxplot of GAD-7", x = "", y = "GAD-7") +
  theme_minimal()
```

```{r gender}
# Liste der Störungsvariablen
stoerungen <- c("mhd.mdd", "mhd.gad", "mhd.social_anxiety", "mhd.specific_phobia",
                "mhd.agoraphobia", "mhd.panic_disorder", "mhd.panic_attacks",
                "mhd.bipolar_disorder", "mhd.ocd", "mhd.bdd", "mhd.an", 
                "mhd.atypical_an", "mhd.bn", "mhd.bed")

# Alle möglichen Gendertypen extrahieren
alle_gender <- levels(dat$gender)

# Leeres Dataframe vorbereiten
ergebnistabelle_gender <- data.frame(matrix(0, nrow = length(stoerungen), ncol = length(alle_gender)))
rownames(ergebnistabelle_gender) <- stoerungen
colnames(ergebnistabelle_gender) <- alle_gender

# Füllen der Tabelle
for (stoerung in stoerungen) {
  # Nur Personen mit der Störung (angenommen: "Not XYZ" ist der 1. Level)
  betroffene <- dat[[stoerung]] != levels(dat[[stoerung]])[1]
  
  # Häufigkeiten nach Gender
  counts <- table(dat$gender[betroffene])
  
  # In Tabelle eintragen
  for (g in names(counts)) {
    ergebnistabelle_gender[stoerung, g] <- counts[[g]]
  }
}

# Ausgabe der Tabelle
print(ergebnistabelle_gender)
```

```{r Sexuell orientation}
# Liste der Störungsvariablen
stoerungen <- c("mhd.mdd", "mhd.gad", "mhd.social_anxiety", "mhd.specific_phobia",
                "mhd.agoraphobia", "mhd.panic_disorder", "mhd.panic_attacks",
                "mhd.bipolar_disorder", "mhd.ocd", "mhd.bdd", "mhd.an", 
                "mhd.atypical_an", "mhd.bn", "mhd.bed")

# Alle möglichen sexuellen Orientierungen extrahieren
alle_orientierungen <- levels(dat$sexual_orientation)

# Leeres Dataframe zum Füllen (Zeilen = Störungen, Spalten = Orientierungen)
ergebnistabelle <- data.frame(matrix(0, nrow = length(stoerungen), ncol = length(alle_orientierungen)))
rownames(ergebnistabelle) <- stoerungen
colnames(ergebnistabelle) <- alle_orientierungen

# Füllen der Tabelle
for (stoerung in stoerungen) {
  # Annahme: Erster Level ist "Not XYZ"
  betroffene <- dat[[stoerung]] != levels(dat[[stoerung]])[1]
  
  # Tabelle der Häufigkeiten
  counts <- table(dat$sexual_orientation[betroffene])
  
  # Eintragen in Ergebnis-Tabelle
  for (orientation in names(counts)) {
    ergebnistabelle[stoerung, orientation] <- counts[[orientation]]
  }
}

# Ausgabe der Tabelle
print(ergebnistabelle)

```