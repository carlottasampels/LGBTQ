---
title: "prs"
author: "Carlotta Sampels"
date: "2025-05-27"
output:
  html_document:
    toc: true
    toc_depth: 4
    number_sections: true
    toc_float:
      collapsed: false
      smooth_scroll: false
    df_print: paged
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Clear Global Environment

```{r clear global environment}
rm(list = ls(all.names = TRUE)) 
```

Read in file with path to ilovedata channel on Teams Ensure that your
credentials directory is correctly located

```{r Read in paths file}
source(file = "credentials/paths.R")
```

## Load packages

```{r Load packages}
library(ggplot2)
library(readr)
```

## Set current date

```{r current date}
#date <- Sys.Date()
date <- "2025-06-19"

```

## Load data

```{r Load data}
dat <- read_rds(
  file =
    paste0(filepath_cleaned_data,"dat_after_exclusion_sexual_orientation", date, ".rds")
)
```

```{r Load data gender}
dat_gender <- read_rds(
  file =
    paste0(filepath_cleaned_data,"dat_after_exclusion_gender", date, ".rds")
)
```

```{r Load data PRS}
dat_prs_bmi <- read.table(filepath_prs_bmi, header = TRUE, sep = "\t", stringsAsFactors = FALSE)
dat_prs_depression <- read.table(filepath_prs_depression, header = TRUE, sep = "\t", stringsAsFactors = FALSE)
dat_prs_anxiety <- read.table(filepath_prs_anxiety, header = TRUE, sep = "\t", stringsAsFactors = FALSE)
dat_prs_an <- read.table(filepath_prs_an, header = TRUE, sep = "\t", stringsAsFactors = FALSE)
```

```{r data principal componance}
dat_prs_pc <- read.table(filepath_prs_pc, header = TRUE, sep = "\t", stringsAsFactors = FALSE)
dat_prs_pc_subset <- dat_prs_pc[, c("FID", "batch", "pc1", "pc2", "pc3", "pc4", "pc5", "pc6")]
```

```{r merge}
#merged <- merge(dat_prs_bmi, dat_gender, by.x = "FID", by.y = "ID")
#merged_dep <- merge(dat_prs_depression, dat_gender, by.x = "FID", by.y = "ID")

merged_bmi <- merge(
  merge(dat_prs_bmi, dat_gender, by.x = "FID", by.y = "ID"),
  dat_prs_pc_subset,
  by = "FID"
)

merged_dep <- merge(
  merge(dat_prs_depression, dat_gender, by.x = "FID", by.y = "ID"),
  dat_prs_pc_subset,
  by = "FID"
)

merged_anxiety <- merge(
  merge(dat_prs_anxiety, dat_gender, by.x = "FID", by.y = "ID"),
  dat_prs_pc_subset,
  by = "FID"
)

merged_an <- merge(
  merge(dat_prs_an, dat_gender, by.x = "FID", by.y = "ID"),
  dat_prs_pc_subset,
  by = "FID"
)
```

```{r regression}
model_bmi <- lm(SCORE ~ pc1 + pc2 + pc3 + pc4 + pc5 + pc6 + batch, data=merged_bmi)
model_dep <- lm(SCORE ~ pc1 + pc2 + pc3 + pc4 + pc5 + pc6 + batch, data=merged_dep)
model_anxiety <- lm(SCORE ~ pc1 + pc2 + pc3 + pc4 + pc5 + pc6 + batch, data=merged_anxiety)
model_an <- lm(SCORE ~ pc1 + pc2 + pc3 + pc4 + pc5 + pc6 + batch, data=merged_an)

summary(model_dep)
summary(model_anxiety)
summary(model_an)

merged_dep$residuals_score <- residuals(model_dep)
merged_bmi$residuals_score <- residuals(model_bmi)
merged_anxiety$residuals_score <- residuals(model_anxiety)
merged_an$residuals_score <- residuals(model_an)
```

```{r regression depression sexual orientation}
reg_sex_orientation_dep <- lm(formula = SCORE ~ pc1 + pc2 + pc3 + pc4 + pc5 + pc6 + batch + sexual_orientation, 
    data = merged_dep)

summary(reg_sex_orientation_dep)
```

```{r regression depression gender}
reg_gender_dep <- lm(formula = SCORE ~ pc1 + pc2 + pc3 + pc4 + pc5 + pc6 + batch + gender, 
    data = merged_dep)

summary(reg_gender_dep)
```

```{r regression anxiety sexual orientation}
reg_sex_orientation_anxiety <- lm(formula = SCORE ~ pc1 + pc2 + pc3 + pc4 + pc5 + pc6 + batch + sexual_orientation, 
    data = merged_anxiety)

summary(reg_sex_orientation_anxiety)
```

```{r regression anxiety gender}
reg_gender_anxiety <- lm(formula = SCORE ~ pc1 + pc2 + pc3 + pc4 + pc5 + pc6 + batch + gender, 
    data = merged_anxiety)

summary(reg_gender_anxiety)
```


```{r regression an sexual orientation}
reg_sex_orientation_an <- lm(formula = SCORE ~ pc1 + pc2 + pc3 + pc4 + pc5 + pc6 + batch + sexual_orientation, 
    data = merged_an)

summary(reg_sex_orientation_an)
```

```{r regression an gender}
reg_gender_an <- lm(formula = SCORE ~ pc1 + pc2 + pc3 + pc4 + pc5 + pc6 + batch + gender, 
    data = merged_an)

summary(reg_gender_an)
```

```{r plot residuen depression}
ggplot(merged_dep, aes(x = residuals_score, fill = sex)) +
  geom_density(alpha = 0.5) +
  facet_wrap(~ sex, nrow = 6) + 
  labs(
    title = "PRS-Residuen nach Biologischem Geschlecht",
    x = "Bereinigter PRS (Residuen)",
    y = "Dichte",
    fill = "Biologisches Geschlecht"
  ) +
  theme_minimal()
ggplot(merged_dep, aes(x = residuals_score, fill = gender)) +
  geom_density(alpha = 0.5) +
  facet_wrap(~ gender, nrow = 6, ncol = 1) + 
  labs(
    title = "PRS-Residuen nach Gender",
    x = "Bereinigter PRS (Residuen)",
    y = "Dichte",
    fill = "Gender"
  ) +
  theme_minimal()

ggplot(merged_dep, aes(x = residuals_score, fill = sexual_orientation)) +
  geom_density(alpha = 0.5) +
facet_wrap(~ sexual_orientation, nrow = 6) + 
  labs(
    title = "PPRS-Residuen nach Sexueller Orientierung",
    x = "Bereinigter PRS (Residuen)",
    y = "Dichte",
    fill = "Sexuelle Orientierung"
  ) +
  theme_minimal()
```

```{r plot residuen anxiety}
ggplot(merged_anxiety, aes(x = residuals_score, fill = sex)) +
  geom_density(alpha = 0.5) +
  facet_wrap(~ sex, nrow = 6) + 
  labs(
    title = "PRS-Residuen nach Biologischem Geschlecht",
    x = "Bereinigter PRS (Residuen)",
    y = "Dichte",
    fill = "Biologisches Geschlecht"
  ) +
  theme_minimal()
ggplot(merged_anxiety, aes(x = residuals_score, fill = gender)) +
  geom_density(alpha = 0.5) +
  facet_wrap(~ gender, nrow = 6, ncol = 1) + 
  labs(
    title = "PRS-Residuen nach Gender",
    x = "Bereinigter PRS (Residuen)",
    y = "Dichte",
    fill = "Gender"
  ) +
  theme_minimal()

ggplot(merged_anxiety, aes(x = residuals_score, fill = sexual_orientation)) +
  geom_density(alpha = 0.5) +
facet_wrap(~ sexual_orientation, nrow = 6) + 
  labs(
    title = "PPRS-Residuen nach Sexueller Orientierung",
    x = "Bereinigter PRS (Residuen)",
    y = "Dichte",
    fill = "Sexuelle Orientierung"
  ) +
  theme_minimal()
```

```{r plot residuen an}
ggplot(merged_an, aes(x = residuals_score, fill = sex)) +
  geom_density(alpha = 0.5) +
  facet_wrap(~ sex, nrow = 6) + 
  labs(
    title = "PRS-Residuen nach Biologischem Geschlecht",
    x = "Bereinigter PRS (Residuen)",
    y = "Dichte",
    fill = "Biologisches Geschlecht"
  ) +
  theme_minimal()
ggplot(merged_an, aes(x = residuals_score, fill = gender)) +
  geom_density(alpha = 0.5) +
  facet_wrap(~ gender, nrow = 6, ncol = 1) + 
  labs(
    title = "PRS-Residuen nach Gender",
    x = "Bereinigter PRS (Residuen)",
    y = "Dichte",
    fill = "Gender"
  ) +
  theme_minimal()

ggplot(merged_an, aes(x = residuals_score, fill = sexual_orientation)) +
  geom_density(alpha = 0.5) +
facet_wrap(~ sexual_orientation, nrow = 6) + 
  labs(
    title = "PPRS-Residuen nach Sexueller Orientierung",
    x = "Bereinigter PRS (Residuen)",
    y = "Dichte",
    fill = "Sexuelle Orientierung"
  ) +
  theme_minimal()
```

```{r plot bmi}
ggplot(merged_bmi, aes(x = SCORE, fill = sex)) +
  geom_density(alpha = 0.5) +
  #facet_wrap(~ sex, nrow = 2) + 
  labs(
    title = "PRS-Verteilung nach Geschlecht",
    x = "Polygenic Risk Score (PRS)",
    y = "Dichte",
    fill = "Geschlecht"
  ) +
  theme_minimal()

ggplot(merged_bmi, aes(x = SCORE, fill = gender)) +
  geom_density(alpha = 0.5) +
  #facet_wrap(~ gender, nrow = 3, ncol = 2) + 
  labs(
    title = "PRS-Verteilung nach Gender",
    x = "Polygenic Risk Score (PRS)",
    y = "Dichte",
    fill = "Gender"
  ) +
  theme_minimal()

ggplot(merged_bmi, aes(x = SCORE, fill = sexual_orientation)) +
  geom_density(alpha = 0.5) +
#facet_wrap(~ sexual_orientation, nrow = 3, ncol = 2) + 
  labs(
    title = "PRS-Verteilung nach Sexueller Orientierung",
    x = "Polygenic Risk Score (PRS)",
    y = "Dichte",
    fill = "Sexuelle Orientierung"
  ) +
  theme_minimal()


```

```{r plot depression ohne Residuen}
ggplot(merged_dep, aes(x = SCORE, fill = sex)) +
  geom_density(alpha = 0.5) +
  #facet_wrap(~ sex, nrow = 2) + 
  labs(
    title = "PRS-Verteilung nach Geschlecht",
    x = "Polygenic Risk Score (PRS)",
    y = "Dichte",
    fill = "Biologisches geschlecht"
  ) +
  theme_minimal()

ggplot(merged_dep, aes(x = SCORE, fill = gender)) +
  geom_density(alpha = 0.5) +
  facet_wrap(~ gender, nrow = 6, ncol = 1) + 
  labs(
    title = "PRS-Verteilung nach Gender",
    x = "Polygenic Risk Score (PRS)",
    y = "Dichte",
    fill = "Gender"
  ) +
  theme_minimal()

ggplot(merged_dep, aes(x = SCORE, fill = sexual_orientation)) +
  geom_density(alpha = 0.5) +
#facet_wrap(~ sexual_orientation, nrow = 3, ncol = 2) + 
  labs(
    title = "PRS-Verteilung nach Sexueller Orientierung",
    x = "Polygenic Risk Score (PRS)",
    y = "Dichte",
    fill = "Sexuelle Orientierung"
  ) +
  theme_minimal()
```
