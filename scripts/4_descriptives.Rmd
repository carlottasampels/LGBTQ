---
title: "Descriptives table"
author: "Christopher Huebel"
date: "2025-03-16"
output:
  html_document:
    toc: true
    toc_depth: 4
    number_sections: true
    toc_float:
      collapsed: false
      smooth_scroll: false
    df_print: paged
editor_options: 
  markdown: 
    wrap: 72
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Clear Global Environment
```{r clear global environment}
rm(list = ls(all.names = TRUE)) 
```

Read in file with path to ilovedata channel on Teams
Ensure that your credentials directory is correctly located
```{r Read in paths file}
source(file = "credentials/paths.R")
```

Add the add_numeric function - used to convert character variables into numeric variables.
Add the sumscores function - used to generate sumscores
Add the package_check function - used to install and load dependencies
```{r Read in functions}
source(file = paste0(ilovedata_scripts, "functions/add_numeric.R"))
source(file = paste0(ilovedata_scripts, "functions/remove_duplicates.R"))
source(file = paste0(ilovedata_scripts, "functions/sumscores.R"))
source(file = paste0(ilovedata_scripts, "functions/package_check.R"))
source(file = paste0(ilovedata_scripts, "functions/imp_check.R"))
source(file = paste0(ilovedata_scripts, "functions/recode_check.R"))
```

Load packages

```{r Load packages}
library(tidyverse)
library(flextable)
library(officer)
library(gtsummary)
```

## Set current date

```{r current date}
date <- Sys.Date()
```

## Load data

```{r Load data}
dat <- read_rds(
  file =
    paste0(filepath_cleaned_data,"dat_after_exclusion", date, ".rds")
)
```

```{r Gender check}
dat %>%
  freq(gender)
```

# dat_demographics

```{r dat_demographics}
dat_demographics <- dat %>%
  select(
    age,
    sex,
    gender,
    ethnicity,
    sexual_orientation,
    height_m,
    bmi,
    dem.highest_education_collapsed,
    phq9.sum_score,
    gad7.sum_score,
    phq.Q9_suicidality_binary,
    mhd.mdd,
    mhd.gad,
    mhd.social_anxiety,
    mhd.specific_phobia,
    mhd.agoraphobia,
    mhd.panic_disorder,
    mhd.panic_attacks,
    mhd.bipolar_disorder,
    mhd.ocd,
    mhd.bdd,
    mhd.an,
    mhd.atypical_an,
    mhd.bn,
    mhd.bed
  )
```

# Variable names

```{r variable names}
names(dat_demographics)
```

# Demographics whole sample

```{r demographics whole sample}
summary_table_whole_sample <-
  dat_demographics %>%
  gtsummary::tbl_summary(
    label = list(
      gender = "Patient's gender",
      dem.sex = "Patient's sex",
      age = "Age [years]",
      ethnicity = "Ethnicity",
      sexual_orientation = "Sexual orientation",
      height_m = "Height [m]",
      bmi = "BMI [kg/m2]",
      dem.highest_education_collapsed = "Highest education",
      phq9.sum_score = "PHQ9 score",
      gad7.sum_score = "GAD7 score",
      phq.Q9_suicidality_binary = "Suicidality",
      mhd.mdd = "Major depressive disorder",
      mhd.gad = "Generalised anxiety disorder",
      mhd.social_anxiety = "Social anxiety",
      mhd.specific_phobia = "Specific phobia",
      mhd.agoraphobia = "Agoraphobia",
      mhd.panic_disorder = "Panic disorder",
      mhd.panic_attacks = "Panic attacks",
      mhd.bipolar_disorder ="Bipolar disorder",
      mhd.ocd = "Obsessive-compulsive disorder",
      mhd.bdd = "Body dysmorphic disorder",
      mhd.an = "Anorexia nervosa", 
      mhd.atypical_an = "Atypical anorexia nervosa",
      mhd.bn = "Bulimia nervosa",
      mhd.bed = "Binge-eating disorder"
      ),
    type = list(
      gender = "categorical",
      dem.sex = "categorical",
      age = "continuous2",
      ethnicity = "categorical",
      sexual_orientation = "categorical",
      height_m = "continuous2",
      bmi = "continuous2",
      dem.highest_education_collapsed = "categorical",
      phq9.sum_score = "continuous2",
      gad7.sum_score = "continuous2",
      phq.Q9_suicidality_binary = "dichotomous",
      mhd.mdd = "dichotomous",
      mhd.gad = "dichotomous",
      mhd.social_anxiety = "dichotomous",
      mhd.specific_phobia = "dichotomous",
      mhd.agoraphobia = "dichotomous",
      mhd.panic_disorder = "dichotomous",
      mhd.panic_attacks = "dichotomous",
      mhd.bipolar_disorder = "dichotomous",
      mhd.ocd = "dichotomous",
      mhd.bdd = "dichotomous",
      mhd.an = "dichotomous",
      mhd.atypical_an = "dichotomous",
      mhd.bn = "dichotomous",
      mhd.bed = "dichotomous"
      ),
    value = list(
      phq.Q9_suicidality_binary = "Any suicidality",
      mhd.mdd = "MDD",
      mhd.gad = "GAD",
      mhd.social_anxiety = "Social anxiety",
      mhd.specific_phobia = "Specific phobia",
      mhd.agoraphobia = "Agoraphobia",
      mhd.panic_disorder = "Panic disorder",
      mhd.panic_attacks = "Panic attacks",
      mhd.bipolar_disorder = "Bipolar disorder",
      mhd.ocd = "OCD",
      mhd.bdd = "BDD",
      mhd.an = "AN", 
      mhd.atypical_an = "Atypical AN",
      mhd.bn = "BN",
      mhd.bed = "BED"
      ),
    missing_text = "Not answered",
    digits = list(
      all_categorical() ~ c(0, 1),
      all_dichotomous() ~ c(0, 1)),
    
    statistic = list(
      all_categorical() ~ "{n} ({p}%)",
      all_continuous() ~ c("{mean} ({sd})", "{median} ({p25}, {p75})",  "{min} - {max}")
      )
    ) %>%
  bold_labels()

summary_table_whole_sample
```


## Save as a word document

```{r word properties 1}
sect_properties1 <- officer::prop_section(
  page_size = page_size(
    orient = "portrait",
    width = 8.3,
    height = 11.7
  ),
  type = "continuous",
  page_margins = page_mar()
)
```


```{r summary_table_whole_sample as word document}
summary_table_whole_sample %>%
  as_flex_table() %>%
  flextable::save_as_docx(
    path = paste0(LGBTQ_folder, "tables/", date, "/LGBTQ_descriptives", date, ".docx"),
    pr_section = sect_properties1
  )
```


# Table clinically significant

```{r dat_demographics_clinical}
dat_demographics_clinical <- dat %>%
  select(
    sex,
    gender,
    ethnicity,
    sexual_orientation,
    dem.highest_education_collapsed,
    phq.Q9_suicidality_binary,
    mhd.mdd,
    mhd.gad,
    mhd.social_anxiety,
    mhd.specific_phobia,
    mhd.agoraphobia,
    mhd.panic_disorder,
    mhd.panic_attacks,
    mhd.bipolar_disorder,
    mhd.ocd,
    mhd.bdd,
    mhd.an,
    mhd.atypical_an,
    mhd.bn,
    mhd.bed
  )
```

```{r}
summary_table_clinical_gender <-
  dat_demographics_clinical %>%
  gtsummary::tbl_summary(
    by = gender, 
    label = list(
      sex = "Biological sex",
      gender = "Patient's gender",
      ethnicity = "Ethnicity",
      sexual_orientation = "Sexual orientation",
      dem.highest_education_collapsed = "Highest education",
      phq.Q9_suicidality_binary = "Suicidality",
      mhd.mdd = "Major depressive disorder",
      mhd.gad = "Generalised anxiety disorder",
      mhd.social_anxiety = "Social Anxiety",
      mhd.specific_phobia = "Specific phobia",
      mhd.agoraphobia = "Agoraphobia",
      mhd.panic_disorder = "Panic disorder",
      mhd.panic_attacks = "Panic attacks",
      mhd.bipolar_disorder ="Bipolar disorder",
      mhd.ocd = "Obsessive-compulsive disorder",
      mhd.bdd = "Body dysmorphic disorder",
      mhd.an = "Anorexia nervosa", 
      mhd.atypical_an = "Atypical anorexia nervosa",
      mhd.bn = "Bulimia nervosa",
      mhd.bed = "Binge-eating disorder"
      ),
    type = list(
      sex = "categorical",
      gender = "categorical",
      ethnicity = "categorical",
      sexual_orientation = "categorical",
      height_m = "continuous2",
      dem.highest_education_collapsed = "categorical",
      phq9.sum_score = "continuous2",
      gad7.sum_score = "continuous2",
      phq.Q9_suicidality_binary = "dichotomous",
      mhd.mdd = "dichotomous",
      mhd.gad = "dichotomous",
      mhd.social_anxiety = "dichotomous",
      mhd.specific_phobia = "dichotomous",
      mhd.agoraphobia = "dichotomous",
      mhd.panic_disorder = "dichotomous",
      mhd.panic_attacks = "dichotomous",
      mhd.bipolar_disorder = "dichotomous",
      mhd.ocd = "dichotomous",
      mhd.bdd = "dichotomous",
      mhd.an = "dichotomous", 
      mhd.atypical_an = "dichotomous",
      mhd.bn = "dichotomous",
      mhd.bed = "dichotomous"
      ),
    value = list(
      phq.Q9_suicidality_binary = "Any suicidality",
      mhd.mdd = "MDD",
      mhd.gad = "GAD",
      mhd.social_anxiety = "Social anxiety",
      mhd.specific_phobia = "Specific phobia",
      mhd.agoraphobia = "Agoraphobia",
      mhd.panic_disorder = "Panic disorder",
      mhd.panic_attacks = "Panic attacks",
      mhd.bipolar_disorder ="Bipolar disorder",
      mhd.ocd = "OCD",
      mhd.bdd = "BDD",
      mhd.an = "AN", 
      mhd.atypical_an = "Atypical AN",
      mhd.bn = "BN",
      mhd.bed = "BED"
      ),
    missing_text = "Not answered",
    digits = list(
      all_categorical() ~ c(0, 1),
      all_dichotomous() ~ c(0, 1)),
    
    statistic = list(
      all_categorical() ~ "{n} ({p}%)",
      all_continuous() ~ c("{mean} ({sd})", "{median} ({p25}, {p75})",  "{min} - {max}")
      )
    ) %>%
  add_p() %>%
  add_overall()

summary_table_clinical_gender
```

```{r}
summary_table_clinical_sexual_orientation <-
  dat_demographics_clinical %>%
  gtsummary::tbl_summary(
    by = sexual_orientation, 
    label = list(
      sex = "Biological sex",
      gender = "Patient's gender",
      ethnicity = "Ethnicity",
      sexual_orientation = "Sexual orientation",
      dem.highest_education_collapsed = "Highest education",
      phq.Q9_suicidality_binary = "Suicidality",
      mhd.mdd = "Major depressive disorder",
      mhd.gad = "Generalised anxiety disorder",
      mhd.social_anxiety = "Social Anxiety",
      mhd.specific_phobia = "Specific phobia",
      mhd.agoraphobia = "Agoraphobia",
      mhd.panic_disorder = "Panic disorder",
      mhd.panic_attacks = "Panic attacks",
      mhd.bipolar_disorder ="Bipolar disorder",
      mhd.ocd = "Obsessive-compulsive disorder",
      mhd.bdd = "Body dysmorphic disorder",
      mhd.an = "Anorexia nervosa", 
      mhd.atypical_an = "Atypical anorexia nervosa",
      mhd.bn = "Bulimia nervosa",
      mhd.bed = "Binge-eating disorder"
      ),
    type = list(
      sex = "categorical",
      gender = "categorical",
      ethnicity = "categorical",
      sexual_orientation = "categorical",
      dem.highest_education_collapsed = "categorical",
      phq.Q9_suicidality_binary = "dichotomous",
      mhd.mdd = "dichotomous",
      mhd.gad = "dichotomous",
      mhd.social_anxiety = "dichotomous",
      mhd.specific_phobia = "dichotomous",
      mhd.agoraphobia = "dichotomous",
      mhd.panic_disorder = "dichotomous",
      mhd.panic_attacks = "dichotomous",
      mhd.bipolar_disorder = "dichotomous",
      mhd.ocd = "dichotomous",
      mhd.bdd = "dichotomous",
      mhd.an = "dichotomous", 
      mhd.atypical_an = "dichotomous",
      mhd.bn = "dichotomous",
      mhd.bed = "dichotomous"
      ),
    value = list(
      phq.Q9_suicidality_binary = "Any suicidality",
      mhd.mdd = "MDD",
      mhd.gad = "GAD",
      mhd.social_anxiety = "Social anxiety",
      mhd.specific_phobia = "Specific phobia",
      mhd.agoraphobia = "Agoraphobia",
      mhd.panic_disorder = "Panic disorder",
      mhd.panic_attacks = "Panic attacks",
      mhd.bipolar_disorder ="Bipolar disorder",
      mhd.ocd = "OCD",
      mhd.bdd = "BDD",
      mhd.an = "AN", 
      mhd.atypical_an = "Atypical AN",
      mhd.bn = "BN",
      mhd.bed = "BED"
      ),
    missing_text = "Not answered",
    digits = list(
      all_categorical() ~ c(0, 1),
      all_dichotomous() ~ c(0, 1)),
    
    statistic = list(
      all_categorical() ~ "{n} ({p}%)",
      all_continuous() ~ c("{mean} ({sd})", "{median} ({p25}, {p75})",  "{min} - {max}")
      )
    ) %>%
  add_p() %>%
  add_overall()

summary_table_clinical_sexual_orientation
```

```{r}
summary_table_clinical <-
  dat_demographics_clinical %>%
  gtsummary::tbl_summary(
    label = list(
      sex = "Biological sex",
      gender = "Patient's gender",
      sexual_orientation = "Sexual orientation",
      mhd.mdd = "Major depressive disorder",
      mhd.gad = "Generalised anxiety disorder",
      mhd.social_anxiety = "Social Anxiety",
      mhd.specific_phobia = "Specific phobia",
      mhd.agoraphobia = "Agoraphobia",
      mhd.panic_disorder = "Panic disorder",
      mhd.panic_attacks = "Panic attacks",
      mhd.bipolar_disorder ="Bipolar disorder",
      mhd.ocd = "Obsessive-compulsive disorder",
      mhd.bdd = "Body dysmorphic disorder",
      mhd.an = "Anorexia nervosa", 
      mhd.atypical_an = "Atypical anorexia nervosa",
      mhd.bn = "Bulimia nervosa",
      mhd.bed = "Binge-eating disorder",
      dem.highest_education_collapsed = "Highest education",
      ethnicity = "Ethnicity",
      phq.Q9_suicidality_binary = "Suicidality"
      ),
    type = list(
      sex = "categorical",
      gender = "categorical",
      ethnicity = "categorical",
      sexual_orientation = "categorical",
      phq.Q9_suicidality_binary = "dichotomous",
      mhd.mdd = "dichotomous",
      mhd.gad = "dichotomous",
      mhd.social_anxiety = "dichotomous",
      mhd.specific_phobia = "dichotomous",
      mhd.agoraphobia = "dichotomous",
      mhd.panic_disorder = "dichotomous",
      mhd.panic_attacks = "dichotomous",
      mhd.bipolar_disorder = "dichotomous",
      mhd.ocd = "dichotomous",
      mhd.bdd = "dichotomous",
      mhd.an = "dichotomous", 
      mhd.atypical_an = "dichotomous",
      mhd.bn = "dichotomous",
      mhd.bed = "dichotomous",
      dem.highest_education_collapsed = "categorical"
      ),
    value = list(
      phq.Q9_suicidality_binary = "Any suicidality",
      mhd.mdd = "MDD",
      mhd.gad = "GAD",
      mhd.social_anxiety = "Social anxiety",
      mhd.specific_phobia = "Specific phobia",
      mhd.agoraphobia = "Agoraphobia",
      mhd.panic_disorder = "Panic disorder",
      mhd.panic_attacks = "Panic attacks",
      mhd.bipolar_disorder ="Bipolar disorder",
      mhd.ocd = "OCD",
      mhd.bdd = "BDD",
      mhd.an = "AN", 
      mhd.atypical_an = "Atypical AN",
      mhd.bn = "BN",
      mhd.bed = "BED"
      ),
    missing_text = "Not answered",
    digits = list(
      all_categorical() ~ c(0, 1),
      all_dichotomous() ~ c(0, 1)),
    
    statistic = list(
      all_categorical() ~ "{n} ({p}%)",
      all_continuous() ~ c("{mean} ({sd})", "{median} ({p25}, {p75})",  "{min} - {max}")
      )
    )

summary_table_clinical
```

## Word document

```{r word properties}
sect_properties_landscape <- officer::prop_section(
  page_size = page_size(
    orient = "landscape",
    width = 8.3,
    height = 11.7
  ),
  type = "continuous",
  page_margins = page_mar()
)
```

```{r summary_table_clinical_gender as word document}
summary_table_clinical_gender %>%
  as_flex_table() %>%
  flextable::save_as_docx(
    path = paste0(LGBTQ_folder, "tables/", date, "/LGBTQ_descriptives_clin_gender", date, ".docx"),
    pr_section = sect_properties_landscape
  )
```

```{r summary_table_clinical_sexual_orientation as word document}
summary_table_clinical_sexual_orientation %>%
  as_flex_table() %>%
  flextable::save_as_docx(
    path = paste0(LGBTQ_folder, "tables/", date, "/LGBTQ_descriptives_clin_sexual_orientation", date, ".docx"),
    pr_section = sect_properties_landscape
  )
```

```{r summary_table_clinical as word document}
summary_table_clinical %>%
  flextable::save_as_docx(
    path = paste0(LGBTQ_folder, "tables/", date, "/LGBTQ_descriptives_clin", date, ".docx"),
    pr_section = sect_properties_landscape
  )

```